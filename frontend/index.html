<!DOCTYPE html>
<html>
<body>

<h2>Upload Image and Save Clicks</h2>

<input type="file" id="imgUploader" name="imgUploader" accept="image/*">
<br>
<img id="uploadedImg" style="max-width: 300px;">
<br>
<textarea id="textBox" placeholder="Write something here..."></textarea>
<button onclick="saveData()">Save</button>

<script>
    let imgUploader = document.getElementById('imgUploader');
    let uploadedImg = document.getElementById('uploadedImg');
    let textBox = document.getElementById('textBox');

    let clicks = [];

    imgUploader.onchange = function(event) {
        let reader = new FileReader();
        reader.onload = function() {
            if (reader.readyState === 2) {
                uploadedImg.src = reader.result;
            }
        }
        reader.readAsDataURL(event.target.files[0]);
    };

    uploadedImg.onclick = function(event) {
        let rect = event.target.getBoundingClientRect();
        let x = event.clientX - rect.left;
        let y = event.clientY - rect.top;
        clicks.push({x: x, y: y});
    };

    function saveData() {
        let data = {
            text: textBox.value,
            clicks: clicks
        };
        
        let dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data));
        let downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "data.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    }
</script>

</body>
</html>
